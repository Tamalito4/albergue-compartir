<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Filtrar Mascotas | Huellitas Villa</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    body {
      background: #f8f9fa;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding-top: 80px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .navbar {
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 10;
    }

    footer {
      background-color: #000;
      color: #fff;
      text-align: center;
      padding: 20px;
      margin-top: auto;
    }

    .sidebar {
      background-color: #fff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .card img {
      object-fit: cover;
      height: 200px;
      transition: transform 0.4s ease;
    }

    .card img:hover {
      transform: scale(1.08);
      cursor: zoom-in;
    }

    /* FORMULARIO PREMIUM PROFESIONAL */
    #formAdopcion {
      margin-top: 10px !important;
      display: none;
      animation: fadeIn 0.4s ease-out;
    }

    .adopcion-wrapper {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(18px);
      border-radius: 25px;
      padding: 35px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.5);
      max-width: 900px;
      margin: 0 auto;
      animation: slideUp 0.6s ease-out;
      display: flex;
      gap: 30px;
    }

    .adopcion-img-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .adopcion-img {
      width: 100%;
      max-width: 340px;
      height: 340px;
      object-fit: cover;
      border-radius: 20px;
      box-shadow: 0 10px 28px rgba(0,0,0,0.3);
      border: 3px solid white;
    }

    .adopcion-form {
      flex: 1.2;
      display: flex;
      flex-direction: column;
    }

    .adopcion-title {
      text-align: center;
      color: #0d6efd;
      font-weight: 800;
      font-size: 2rem;
      margin-bottom: 15px;
    }

    .adopcion-label {
      font-weight: 600;
      margin-top: 10px;
    }

    .adopcion-input,
    .adopcion-textarea {
      background: rgba(255,255,255,0.85);
      border-radius: 12px;
      padding: 12px;
      border: none;
      width: 100%;
      font-size: 1.05rem;
      box-shadow: 0 4px 18px rgba(0,0,0,0.15);
    }

    .adopcion-textarea {
      height: 130px;
      resize: none;
    }

    .btn-large {
      padding: 12px;
      font-size: 1.1rem;
      font-weight: bold;
      border-radius: 12px;
    }

    #mensajeAdopcion {
      font-weight: bold;
      text-align: center;
      margin-top: 10px;
      font-size: 1.1rem;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to   { opacity: 1; }
    }

    @media (max-width: 768px) {
      .adopcion-wrapper {
        flex-direction: column;
        text-align: center;
      }
      .adopcion-img {
        width: 90%;
        height: auto;
      }
    }
/* BAJA EL TEXTO "Logueado como..." PARA QUE QUEDE A LA MISMA ALTURA */
.navbar-text {
  padding-top: 0.45rem !important;
  padding-bottom: 0.45rem !important;
  display: flex !important;
  align-items: center !important;
}


  </style>

</head>

<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center gap-2" href="index.html">
      <img src="huellitas.avif" alt="Logo Huellitas" style="height:40px;width:40px;border-radius:50%;">
      <span>Huellitas Villa</span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="index.html">Inicio</a></li>
        <li class="nav-item"><a class="nav-link active" href="filtro.html">Filtrar Mascotas</a></li>
        <li class="nav-item"><a class="nav-link" href="sobrenosotros.html">Sobre Nosotros</a></li>
        <li class="nav-item"><a class="nav-link" href="contactanos.html">Contáctanos</a></li>
        <li class="nav-item"><a class="nav-link" href="donaciones.html">Donaciones</a></li>
        <li class="nav-item"><a class="nav-link" href="campaña.html">Campaña</a></li>

        <li class="nav-item" id="loginItem">
          <a class="nav-link" href="usuario.html">Login</a>
        </li>
      </ul>

<script>
  const user = JSON.parse(localStorage.getItem("usuarioLogueado"));
  if (user) {
    const nav = document.querySelector(".navbar-nav");

    nav.innerHTML += `
      <li class="nav-item">
  <span class="navbar-text text-white">Logueado como ${user.usuario}</span>
</li>

      <li class="nav-item"><a class="nav-link" href="perfil.html">Mi Perfil</a></li>
    `;

    const loginItem = nav.querySelector('#loginItem');
    if (loginItem) loginItem.remove();
  }
</script>

</div> 
</div> 
</nav>

<main class="container-fluid">
  <div class="row">
    <!-- Filtros -->
    <div class="col-md-3">
      <div class="sidebar">
        <h4>Filtrar Mascotas</h4>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="tipoMascota" id="filtroTodos" value="todos" checked />
          <label class="form-check-label" for="filtroTodos">Todos</label>
        </div>
        <div class="form-check mt-2">
          <input class="form-check-input" type="radio" name="tipoMascota" id="filtroGatos" value="gato" />
          <label class="form-check-label" for="filtroGatos">Gatos</label>
        </div>
        <div class="form-check mt-2">
          <input class="form-check-input" type="radio" name="tipoMascota" id="filtroPerros" value="perro" />
          <label class="form-check-label" for="filtroPerros">Perros</label>
        </div>
      </div>
    </div>

    <!-- Resultados -->
    <div class="col-md-9">
      <div class="row" id="contenedorMascotas"></div>
    </div>
  </div>

  <!-- FORMULARIO PREMIUM -->
  <div id="formAdopcion" class="my-4">
    <div class="adopcion-wrapper">

      <div class="adopcion-img-container">
        <img id="adopcionFoto" class="adopcion-img" src="" alt="Mascota seleccionada">
      </div>

      <div class="adopcion-form">
        <h3 class="adopcion-title">Solicitud de Adopción</h3>

        <label class="adopcion-label">Nombre de la mascota</label>
        <input type="text" id="mascotaAdoptar" class="adopcion-input" readonly>

        <label class="adopcion-label">Motivo de adopción</label>
        <textarea id="motivoAdopcion" class="adopcion-textarea" placeholder="Escribe el motivo..." required></textarea>

        <div class="d-flex justify-content-between mt-3">
          <button type="button" class="btn btn-secondary btn-large" onclick="regresarALista()">Cancelar</button>
          <button type="submit" form="formAdopcionMascota" class="btn btn-success btn-large">Enviar Solicitud</button>
        </div>

        <div id="mensajeAdopcion"></div>
      </div>

    </div>

    <form id="formAdopcionMascota" style="display:none;"></form>
  </div>

</main>

<footer>
  <div class="container">
    <p style="margin: 0;">&copy; 2025 Huellitas Villa. Todos los derechos reservados.</p>
  </div>
</footer>


<!-- JavaScript -->
<script>

  /* ACTIVAR FILTRADO COMO ANTES */
  document.addEventListener("DOMContentLoaded", () => {
    const filtros = document.querySelectorAll('input[name="tipoMascota"]');
    filtros.forEach(filtro => {
      filtro.addEventListener("change", (e) => {
        mostrarMascotas(e.target.value);
      });
    });
  });

  const mascotas = {
    gato: [
      { nombre: "Milo", edad: 2, descripcion: "Tranquilo y curioso.", foto: "gato1.avif" },
      { nombre: "Nina", edad: 3, descripcion: "Muy cariñosa.", foto: "gato2.jpg" },
      { nombre: "Simba", edad: 1, descripcion: "Juguetón y ágil.", foto: "gato3.jpg" },
      { nombre: "Luna", edad: 2, descripcion: "Tierna y dormilona.", foto: "gato4.avif" },
      { nombre: "Tom", edad: 4, descripcion: "Ama los abrazos.", foto: "gato5.jpg" },
      { nombre: "Zoe", edad: 2, descripcion: "Siempre busca compañía.", foto: "gato6.jpg" },
    ],
    perro: [
      { nombre: "Rocky", edad: 4, descripcion: "Protector y leal.", foto: "perro1.jpg" },
      { nombre: "Toby", edad: 3, descripcion: "Muy activo.", foto: "perro2.jpg" },
      { nombre: "Bruno", edad: 2, descripcion: "Inteligente y amistoso.", foto: "perro3.jpg" },
      { nombre: "Lola", edad: 1, descripcion: "Juguetona y dulce.", foto: "perro4.jpeg" },
      { nombre: "Max", edad: 5, descripcion: "Fiel compañero.", foto: "perro5.avif" },
      { nombre: "Bella", edad: 3, descripcion: "Le encanta correr.", foto: "perro6.jpg" },
    ]
  };

  async function obtenerAdopciones() {
    const sesion = JSON.parse(localStorage.getItem("usuarioLogueado"));
    if (!sesion || !sesion.usuario) return {};
    try {
      const res = await fetch(`http://localhost:8080/api/adopciones/estado/${sesion.usuario}`);
      return Object.fromEntries((await res.json()).map(a => [a.nombre_animal, a.estado]));
    } catch {
      return {};
    }
  }

  async function mostrarMascotas(tipo) {
    const contenedor = document.getElementById("contenedorMascotas");
    contenedor.innerHTML = "";
    contenedor.style.display = "flex";

    let animales = tipo === "gato" ? mascotas.gato :
                   tipo === "perro" ? mascotas.perro :
                   [...mascotas.gato, ...mascotas.perro];

    const adopciones = await obtenerAdopciones();

    animales.forEach(mascota => {
      const estado = adopciones[mascota.nombre];
      let boton =
        estado === "aprobada" ? `<span class="btn btn-success disabled mt-auto">Adoptado</span>` :
        estado === "pendiente" ? `<span class="btn btn-warning disabled mt-auto">Solicitud en proceso</span>` :
        `<button class="btn btn-primary mt-auto" onclick="mostrarFormularioAdopcion('${mascota.nombre}', '${mascota.foto}')">Saber más</button>`;

      const col = document.createElement("div");
      col.className = "col-md-4";
      col.innerHTML = `
        <div class="card h-100 shadow-sm">
          <img src="${mascota.foto}" alt="${mascota.nombre}" class="card-img-top">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">${mascota.nombre}</h5>
            <p><strong>Edad:</strong> ${mascota.edad} años</p>
            <p>${mascota.descripcion}</p>
            ${boton}
          </div>
        </div>`;
      contenedor.appendChild(col);
    });
  }

  function mostrarFormularioAdopcion(nombre, foto) {
    const user = JSON.parse(localStorage.getItem("usuarioLogueado"));
    if (!user) {
      alert("Debes iniciar sesión primero.");
      return (window.location.href = "usuario.html");
    }

    document.getElementById("contenedorMascotas").style.display = "none";
    document.getElementById("formAdopcion").style.display = "block";

    document.getElementById("mascotaAdoptar").value = nombre;
    document.getElementById("adopcionFoto").src = foto;
    document.getElementById("motivoAdopcion").value = "";
    document.getElementById("mensajeAdopcion").innerText = "";
  }

  function regresarALista() {
    document.getElementById("formAdopcion").style.display = "none";
    document.getElementById("contenedorMascotas").style.display = "flex";
  }

  document.getElementById("formAdopcionMascota").onsubmit = async e => {
    e.preventDefault();
    const mascota = document.getElementById("mascotaAdoptar").value;
    const motivo = document.getElementById("motivoAdopcion").value;
    const usuario = JSON.parse(localStorage.getItem("usuarioLogueado")).usuario;
    const msg = document.getElementById("mensajeAdopcion");

    try {
      const res = await fetch("http://localhost:8080/api/adopciones/solicitar", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ usuario, nombre_animal: mascota, motivo })
      });

      const text = await res.text();
      msg.style.color = res.ok ? "green" : "red";
      msg.innerText = text;

      if (res.ok) {
        setTimeout(() => {
          regresarALista();
          mostrarMascotas("todos");
        }, 2000);
      }
    } catch {
      msg.style.color = "red";
      msg.innerText = "Error de conexión.";
    }
  };

  window.onload = () => mostrarMascotas("todos");

</script>

</body>
</html>