<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Administrar Animales</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
  <div class="container mt-5">
    <h2 class="mb-4">Panel de Administración de Animales</h2>

    <!-- FORMULARIO AGREGAR ANIMAL -->
    <div class="card p-4 mb-4">
      <h4>Agregar Animal</h4>
      <form id="formAgregar">
        <div class="mb-3">
          <label>Nombre:</label>
          <input type="text" class="form-control" id="nombre" required>
        </div>
        <div class="mb-3">
          <label>Especie:</label>
          <input type="text" class="form-control" id="especie" required>
        </div>
        <div class="mb-3">
          <label>Edad:</label>
          <input type="number" class="form-control" id="edad" required>
        </div>
        <button type="submit" class="btn btn-primary">Agregar</button>
      </form>
    </div>

    <!-- LISTADO DE ANIMALES -->
    <div class="card p-4 mb-4">
      <h4>Animales Registrados</h4>
      <ul id="listaAnimales" class="list-group"></ul>
    </div>
  </div>

  <!-- Java Script -->

  <script>
    const lista = document.getElementById("listaAnimales");

    async function cargarAnimales() {
      lista.innerHTML = "";
      const res = await fetch("http://localhost:8080/api/animales");
      const animales = await res.json();

      animales.forEach(a => {
        const li = document.createElement("li");
        li.className = "list-group-item d-flex justify-content-between align-items-center";
        li.innerHTML = `
          <div>
            <strong>${a.nombre}</strong> - ${a.especie} (${a.edad} años)
          </div>
          <div>
            <button onclick="eliminarAnimal(${a.id})" class="btn btn-danger btn-sm">Eliminar</button>
          </div>
        `;
        lista.appendChild(li);
      });
    }

    document.getElementById("formAgregar").addEventListener("submit", async function (e) {
      e.preventDefault();

      const data = {
        nombre: document.getElementById("nombre").value,
        especie: document.getElementById("especie").value,
        edad: parseInt(document.getElementById("edad").value)
      };

      const res = await fetch("http://localhost:8080/api/animales", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      if (res.ok) {
        alert("Animal agregado");
        cargarAnimales();
        this.reset();
      } else {
        alert("Error al agregar");
      }
    });

    async function eliminarAnimal(id) {
      if (!confirm("¿Seguro que deseas eliminar este animal?")) return;

      const res = await fetch(`http://localhost:8080/api/animales/${id}`, {
        method: "DELETE"
      });

      if (res.ok) {
        alert("Animal eliminado");
        cargarAnimales();
      } else {
        alert("Error al eliminar");
      }
    }

    cargarAnimales();
  </script>
</body>
</html>
